(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();class I{static play(t){const s=new window.AudioContext,e=this.explodeEvents(t),r=this.createOscillators(e,s);this.playEvents(e,r,s)}static explodeEvents(t){const s=[];let e=0;return t.forEach((r,i)=>{r.frequencies.forEach((n,h)=>{s.push({id:1e3*i+h,frequency:n,startMoment:e/1e3,endMoment:(e+r.msLength)/1e3})}),e+=r.msLength}),s}static createOscillators(t,s){const e=new Map,r=s.createGain();return r.gain.value=.3,r.connect(s.destination),t.forEach(i=>{const n=s.createOscillator();n.frequency.value=i.frequency,n.type="triangle",n.connect(r),e.set(i.id,n)}),e}static playEvents(t,s,e){let r=e.currentTime+1;t.forEach(i=>{const n=s.get(i.id);n&&(n.start(r+i.startMoment),n.stop(r+i.endMoment))})}}var p=class M{constructor(t,s){this.w=t,this.h=s}static fromChroma(t,s){let[e,r]=[t*3,t];for(++s;(e+r)/7>s;)e-=5,r-=2;for(;(e+r)/7<s;)e+=5,r+=2;return new M(e,r)}get midi(){const t=2*this.w+this.h;if(t>=0&&t<128)return t;throw new Error(`Outside of standard MIDI range: ${t}`)}get chroma(){return this.w*2-this.h*5}get pc7(){return((this.w+this.h)%7+7)%7}get pc12(){return(this.midi%12+12)%12}get letter(){return"CDEFGAB".charAt(this.pc7)}get accidental(){return Math.floor((this.chroma+1)/7)}get octave(){return Math.floor((this.w+this.h)/7-1)}stepsTo(t){return t.w+t.h-(this.w+this.h)}isEqual(t){return this.w===t.w&&this.h===t.h}isEnharmonic(t,s=12){return(this.chroma%s+s)%s===(t.chroma%s+s)%s}intervalTo(t){return E.between(this,t)}transposeReal(t){return new M(this.w+t.w,this.h+t.h)}invert(t){return new M(t.w-this.w,t.h-this.h)}degreeIn(t){return t.degreeNumber(this)}alterationIn(t){return t.degreeAlteration(this)}snapTo(t){return t.snapDiatonic(this)}transposeDiatonic(t,s){return this.transposeReal(new E(t,0)).snapTo(s)}static highest(t,s=y.fromEDO(12)){return t.reduce((e,r)=>s.toHz(e)>s.toHz(r)?e:s.toHz(e)<s.toHz(r)?r:e.stepsTo(r)<0?e:r)}static lowest(t,s=y.fromEDO(12)){return t.reduce((e,r)=>s.toHz(e)<s.toHz(r)?e:s.toHz(e)>s.toHz(r)?r:e.stepsTo(r)>0?e:r)}nearest(t,s=y.fromEDO(12)){function e(n,h){return Math.max(s.toRatio(n.intervalTo(h)),s.toRatio(h.intervalTo(n)))}const r=t.sort((n,h)=>e(this,n)-e(this,h))[0];return t.filter(n=>e(this,n)===e(this,r)).sort((n,h)=>this.stepsTo(n)-this.stepsTo(h))[0]}};p.range={*diatonic(o,t,s){let e=new p(o.w,o.h);for(yield e.snapTo(s);e.stepsTo(t)>0;)e=e.transposeDiatonic(1,s),yield new p(e.w,e.h)},*chromatic(o,t,s){let e=new p(o.w,o.h),r=s.nearestMiBelow(e),i=r.h,n=s.nextMiAbove(r);const h=t;for(;n.stepsTo(h)>0;){for(;e.w<=n.w-1;){for(;e.h<=n.h+1;){if(e.stepsTo(o)>0){e.h++;continue}yield new p(e.w,e.h),e.h++}e.h=i,e.w++}i=n.h,n=s.nextMiAbove(n)}for(;e.w<=h.w;){for(;e.h<=n.h+1;){if(e.stepsTo(h)<0)return;yield new p(e.w,e.h),e.h++}e.h=i,e.w++}}};var S=p,v=class{static toPitch(o){const t=/^([A-Ga-g])([#bxw]+)?(-?\d+)$/,s=o.match(t);if(!s)throw new Error(`Invalid SPN: ${o}`);const[,e,r="",i]=s,n=parseInt(i,10)+1;let{w:h,h:m}=L["CDEFGAB".indexOf(e.toUpperCase())],a=0;const w=r.split("");return a+=w.filter(l=>l==="#").length,a+=2*w.filter(l=>l==="x").length,a-=w.filter(l=>l==="b").length,a-=2*w.filter(l=>l==="w").length,h+=a,m-=a,h+=5*n,m+=2*n,new S(h,m)}static fromPitch(o){let t=o.letter;const s=o.accidental;return s==2?t+="x":s>0&&(t+="#".repeat(s)),s<0&&(t+="b".repeat(-s)),t+=o.octave.toString(),t}},u=class f{constructor(t,s){this.w=t,this.h=s}static fromName(t){const s=[{w:0,h:0},{w:1,h:0},{w:2,h:0},{w:2,h:1},{w:3,h:1},{w:4,h:1},{w:5,h:1}],e=t[0]==="-"?-1:1,r=/^-?([PpMmAaDd#b]+)?(\d+)$/,i=t.match(r);if(!i)throw new Error(`Invalid interval name: ${t}`);const[,n="",h]=i,m=parseInt(h,10),a=(m-1)%7;let{w,h:l}=s[a];const B=Math.floor((m-1)/7);w+=5*B,l+=2*B;let g=0,P=n.split("");g+=P.filter(d=>d==="A"||d==="a"||d==="#").length,g-=P.filter(d=>d==="m"||d==="b").length;const C=P.filter(d=>d==="D"||d==="d").length;return g-=C,C!==0&&a!==0&&a!==3&&a!==4&&g--,w+=g,l-=g,new f(e*w,e*l)}static fromSPN(t,s){return f.between(v.toPitch(t),v.toPitch(s))}static between(t,s){return new f(s.w-t.w,s.h-t.h)}get chroma(){return this.w*2-this.h*5}get isDiatonic(){return Math.abs(this.chroma)<7}get quality(){const t=this.stepspan<0?-1:1,s=this.chroma;return Math.abs(s)<=1?0:s>0&&s<=5?t*Math.floor((s+5)/7):s<0&&s>=-5?t*Math.ceil((s-5)/7):s>5?t*Math.floor((s+8)/7):t*Math.floor((s-2)/7)}get stepspan(){return this.w+this.h}get pc7(){return(this.stepspan%7+7)%7}get pc12(){return((this.w*2+this.h)%12+12)%12}get name(){let t="";const s=this.stepspan;this.stepspan<0&&(t+="-");const e=this.quality;return e>1&&(t+="A".repeat(e-1)),e===1&&(t+="M"),e===0&&(t+="P"),e===-1&&(t+="m"),e<-1&&(t+="d".repeat(-e-1)),t+=(Math.abs(s)+1).toString(),t}isEqual(t){return this.w===t.w&&this.h===t.h}isEnharmonic(t,s=12){return(this.chroma%s+s)%s===(t.chroma%s+s)%s}get negative(){return new f(-this.w,-this.h)}add(t){return new f(this.w+t.w,this.h+t.h)}subtract(t){return new f(this.w-t.w,this.h-t.h)}get simple(){const t=Math.trunc((this.w+this.h)/7);return new f(this.w-t*5,this.h-t*2)}};u.range={*diatonic(o=new u(0,0),t=new u(5,2)){const s=new u(5,2);let e=new u(o.w,o.h),r=e.add(s);const i=e.quality<0?-1:0;let n=e.h+i;const h=t;for(;h.subtract(r).stepspan>0;){for(;e.w<=r.w;){for(e.h=n;e.h<=r.h+1;)e.isDiatonic&&(yield new u(e.w,e.h)),e.h++;e.w++}r=r.add(s),n=e.h+i}for(;e.w<=r.w;){for(e.h=n;e.h<=r.h+1;){if(h.subtract(e).stepspan<0&&e.h++,e.w===h.w&&e.h>h.h)return;e.isDiatonic&&(yield new u(e.w,e.h)),e.h++}e.w++}},*melodic(){let o=new u(0,0);for(;o.w<=5;){for(;o.h<=2;)Math.abs(o.chroma)<6&&o.stepspan!==6&&(yield new u(o.w,o.h)),o.h++;o.h=0,o.w++}}};var E=u,b=class{constructor(o,t){this.x=o,this.y=t}toPitch(){return new S(this.x,this.y)}toInterval(){return new E(this.x,this.y)}},D=class T{constructor(t,s){this.m0=t,this.m1=s}map(t){return t instanceof b?this.m0*t.x+this.m1*t.y:this.m0*t.w+this.m1*t.h}compose(t){return new T(this.m0*t.m00+this.m1*t.m10,this.m0*t.m01+this.m1*t.m11)}},q=class O{constructor(t,s,e,r){this.m00=t,this.m01=s,this.m10=e,this.m11=r}map(t){return t instanceof b?new b(this.m00*t.x+this.m01*t.y,this.m10*t.x+this.m11*t.y):new b(this.m00*t.w+this.m01*t.h,this.m10*t.w+this.m11*t.h)}compose(t){return new O(this.m00*t.m00+this.m01*t.m10,this.m00*t.m01+this.m01*t.m11,this.m10*t.m00+this.m11*t.m10,this.m10*t.m01+this.m11*t.m11)}},y=class A{constructor(t,s="C4",e=261.6255653,r){this.referencePitch=v.toPitch(s),this.referenceFreq=e,this.centMap=new D(t,1200),r!==void 0&&(this.midiMap=r)}static fromEDO(t,s="C4",e=261.6255653){const r=Math.round(Math.log2(1.5)*t),i=r*1200/t,n=(r*2%t+t)%t,h=(r*-5%t+t)%t,m=new D(n,h);return new A(i,s,e,m)}toCents(t){return this.centMap.map(R.map(t))}toRatio(t){return 2**(this.toCents(t)/1200)}toHz(t){return this.referenceFreq*this.toRatio(this.referencePitch.intervalTo(t))}toMIDI(t){if(this.midiMap===void 0)throw new Error("Pitch.toMidi can only be called from an EDO TuningMap.");return this.midiMap.map(t)}},L=[{w:0,h:0},{w:1,h:0},{w:2,h:0},{w:2,h:1},{w:3,h:1},{w:4,h:1},{w:5,h:1}],R=new q(2,-5,-1,3);class c{static from(t,s){return E.fromName(t).add(new E(5*s,2*s))}}class z{static orchestrateCadence(t,s){const e=this.mapLetterToBasePitch(t,s);return this.getCadenceChordShapes().map(n=>this.buildChordFromShape(e,n)).map(n=>this.buildEventFromChord(n,s,1e3))}static mapLetterToBasePitch(t,s){let e=v.toPitch(`${t}3`);const r=v.toPitch("D3");return e==S.highest([e,r],y.fromEDO(s))&&(e=e.transposeReal(new E(-5,-2))),e}static getCadenceChordShapes(){return[[c.from("P1",0),c.from("M3",1),c.from("P5",1),c.from("P1",2)],[c.from("P4",0),c.from("P4",1),c.from("M6",1),c.from("P1",2)],[c.from("P5",0),c.from("M2",1),c.from("P5",1),c.from("M7",1)],[c.from("P1",0),c.from("M3",1),c.from("P5",1),c.from("P1",2)]]}static buildChordFromShape(t,s){return s.map(e=>t.transposeReal(e))}static buildEventFromChord(t,s,e){const r=y.fromEDO(s);return{frequencies:t.map(n=>r.toHz(n)),msLength:e}}}class H{rootElement=document.getElementById("key-selector");whiteKeys=["C","D","E","F","G","A","B"];sharps=["C#","D#","F#","G#","A#"];flats=["Db","Eb","Gb","Ab","Bb"];selectedValue="C";constructor(){this.setUpButtons(),this.select("C")}getSelected(){return this.selectedValue}select(t){this.selectedValue=t,this.unselectButtons(),this.selectButton(t)}setUpButtons(){const t=this.rootElement;t&&(this.setUpButtonRow(this.sharps,"sharps",t),this.setUpButtonRow(this.whiteKeys,"whitekeys",t),this.setUpButtonRow(this.flats,"flats",t))}setUpButtonRow(t,s,e){const r=document.createElement("div");r.className=s,e.appendChild(r),t.forEach(i=>{const n=document.createElement("button");n.textContent=i,n.id=i,n.className="key-button",r.appendChild(n),n.addEventListener("click",()=>this.select(i))})}unselectButtons(){document.querySelectorAll(".key-button").forEach(t=>t.classList.remove("active"))}selectButton(t){const s=document.getElementById(t);s&&s.classList.add("active")}}class N{rootElement=document.getElementById("edo-selector");availableTunings=[12,19,31,50,55];selectedValue=12;constructor(){this.setUpButtons(),this.select(31)}getSelected(){return this.selectedValue}select(t){this.selectedValue=t,this.unselectButtons(),this.selectButton(t.toString())}setUpButtons(){const t=this.rootElement;t&&this.availableTunings.forEach(s=>{const e=document.createElement("button");e.textContent=s.toString(),e.id=s.toString(),e.className="tuning-button",t.appendChild(e),e.addEventListener("click",()=>this.select(s))})}unselectButtons(){document.querySelectorAll(".tuning-button").forEach(t=>t.classList.remove("active"))}selectButton(t){const s=document.getElementById(t);s&&s.classList.add("active")}}document.querySelector("#app").innerHTML=`
  <div>
    <h1>Cadence Test</h1>
    <div class="card">
      <h2>Select Key</h2>
      <div id="key-selector"></div>
    </div>
    <div class="card">
      <h2>Select EDO</h2>
      <div id="edo-selector"></div>
    </div>
    <div class="card">
      <h2>Play</h2>
      <button id="cadence" type="button">Test Cadence</button>
    </div>
  </div>
`;const x=new H,F=new N;document.querySelector("#cadence")?.addEventListener("click",()=>{const o=z.orchestrateCadence(x.getSelected(),F.getSelected());I.play(o)});
