(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&e(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();class I{static play(t){const r=new window.AudioContext,e=this.explodeEvents(t),i=this.createOscillators(e,r);this.playEvents(e,i,r)}static explodeEvents(t){const r=[];let e=0;return t.forEach((i,n)=>{i.frequencies.forEach((s,o)=>{r.push({id:1e3*n+o,frequency:s,startMoment:e/1e3,endMoment:(e+i.msLength)/1e3})}),e+=i.msLength}),r}static createOscillators(t,r){const e=new Map,i=r.createGain();return i.gain.value=.3,i.connect(r.destination),t.forEach(n=>{const s=r.createOscillator();s.frequency.value=n.frequency,s.type="triangle",s.connect(i),e.set(n.id,s)}),e}static playEvents(t,r,e){let i=e.currentTime+1;t.forEach(n=>{const s=r.get(n.id);s&&(s.start(i+n.startMoment),s.stop(i+n.endMoment))})}}var p=class E{constructor(t,r){this.w=t,this.h=r}static fromChroma(t,r){let[e,i]=[t*3,t];for(++r;(e+i)/7>r;)e-=5,i-=2;for(;(e+i)/7<r;)e+=5,i+=2;return new E(e,i)}get midi(){const t=2*this.w+this.h;if(t>=0&&t<128)return t;throw new Error(`Outside of standard MIDI range: ${t}`)}get chroma(){return this.w*2-this.h*5}get pc7(){return((this.w+this.h)%7+7)%7}get pc12(){return(this.midi%12+12)%12}get letter(){return"CDEFGAB".charAt(this.pc7)}get accidental(){return Math.floor((this.chroma+1)/7)}get octave(){return Math.floor((this.w+this.h)/7-1)}stepsTo(t){return t.w+t.h-(this.w+this.h)}isEqual(t){return this.w===t.w&&this.h===t.h}isEnharmonic(t,r=12){return(this.chroma%r+r)%r===(t.chroma%r+r)%r}intervalTo(t){return M.between(this,t)}transposeReal(t){return new E(this.w+t.w,this.h+t.h)}invert(t){return new E(t.w-this.w,t.h-this.h)}degreeIn(t){return t.degreeNumber(this)}alterationIn(t){return t.degreeAlteration(this)}snapTo(t){return t.snapDiatonic(this)}transposeDiatonic(t,r){return this.transposeReal(new M(t,0)).snapTo(r)}static highest(t,r=y.fromEDO(12)){return t.reduce((e,i)=>r.toHz(e)>r.toHz(i)?e:r.toHz(e)<r.toHz(i)?i:e.stepsTo(i)<0?e:i)}static lowest(t,r=y.fromEDO(12)){return t.reduce((e,i)=>r.toHz(e)<r.toHz(i)?e:r.toHz(e)>r.toHz(i)?i:e.stepsTo(i)>0?e:i)}nearest(t,r=y.fromEDO(12)){function e(s,o){return Math.max(r.toRatio(s.intervalTo(o)),r.toRatio(o.intervalTo(s)))}const i=t.sort((s,o)=>e(this,s)-e(this,o))[0];return t.filter(s=>e(this,s)===e(this,i)).sort((s,o)=>this.stepsTo(s)-this.stepsTo(o))[0]}};p.range={*diatonic(h,t,r){let e=new p(h.w,h.h);for(yield e.snapTo(r);e.stepsTo(t)>0;)e=e.transposeDiatonic(1,r),yield new p(e.w,e.h)},*chromatic(h,t,r){let e=new p(h.w,h.h),i=r.nearestMiBelow(e),n=i.h,s=r.nextMiAbove(i);const o=t;for(;s.stepsTo(o)>0;){for(;e.w<=s.w-1;){for(;e.h<=s.h+1;){if(e.stepsTo(h)>0){e.h++;continue}yield new p(e.w,e.h),e.h++}e.h=n,e.w++}n=s.h,s=r.nextMiAbove(s)}for(;e.w<=o.w;){for(;e.h<=s.h+1;){if(e.stepsTo(o)<0)return;yield new p(e.w,e.h),e.h++}e.h=n,e.w++}}};var D=p,P=class{static toPitch(h){const t=/^([A-Ga-g])([#bxw]+)?(-?\d+)$/,r=h.match(t);if(!r)throw new Error(`Invalid SPN: ${h}`);const[,e,i="",n]=r,s=parseInt(n,10)+1;let{w:o,h:m}=R["CDEFGAB".indexOf(e.toUpperCase())],c=0;const f=i.split("");return c+=f.filter(l=>l==="#").length,c+=2*f.filter(l=>l==="x").length,c-=f.filter(l=>l==="b").length,c-=2*f.filter(l=>l==="w").length,o+=c,m-=c,o+=5*s,m+=2*s,new D(o,m)}static fromPitch(h){let t=h.letter;const r=h.accidental;return r==2?t+="x":r>0&&(t+="#".repeat(r)),r<0&&(t+="b".repeat(-r)),t+=h.octave.toString(),t}},u=class d{constructor(t,r){this.w=t,this.h=r}static fromName(t){const r=[{w:0,h:0},{w:1,h:0},{w:2,h:0},{w:2,h:1},{w:3,h:1},{w:4,h:1},{w:5,h:1}],e=t[0]==="-"?-1:1,i=/^-?([PpMmAaDd#b]+)?(\d+)$/,n=t.match(i);if(!n)throw new Error(`Invalid interval name: ${t}`);const[,s="",o]=n,m=parseInt(o,10),c=(m-1)%7;let{w:f,h:l}=r[c];const C=Math.floor((m-1)/7);f+=5*C,l+=2*C;let g=0,b=s.split("");g+=b.filter(w=>w==="A"||w==="a"||w==="#").length,g-=b.filter(w=>w==="m"||w==="b").length;const S=b.filter(w=>w==="D"||w==="d").length;return g-=S,S!==0&&c!==0&&c!==3&&c!==4&&g--,f+=g,l-=g,new d(e*f,e*l)}static fromSPN(t,r){return d.between(P.toPitch(t),P.toPitch(r))}static between(t,r){return new d(r.w-t.w,r.h-t.h)}get chroma(){return this.w*2-this.h*5}get isDiatonic(){return Math.abs(this.chroma)<7}get quality(){const t=this.stepspan<0?-1:1,r=this.chroma;return Math.abs(r)<=1?0:r>0&&r<=5?t*Math.floor((r+5)/7):r<0&&r>=-5?t*Math.ceil((r-5)/7):r>5?t*Math.floor((r+8)/7):t*Math.floor((r-2)/7)}get stepspan(){return this.w+this.h}get pc7(){return(this.stepspan%7+7)%7}get pc12(){return((this.w*2+this.h)%12+12)%12}get name(){let t="";const r=this.stepspan;this.stepspan<0&&(t+="-");const e=this.quality;return e>1&&(t+="A".repeat(e-1)),e===1&&(t+="M"),e===0&&(t+="P"),e===-1&&(t+="m"),e<-1&&(t+="d".repeat(-e-1)),t+=(Math.abs(r)+1).toString(),t}isEqual(t){return this.w===t.w&&this.h===t.h}isEnharmonic(t,r=12){return(this.chroma%r+r)%r===(t.chroma%r+r)%r}get negative(){return new d(-this.w,-this.h)}add(t){return new d(this.w+t.w,this.h+t.h)}subtract(t){return new d(this.w-t.w,this.h-t.h)}get simple(){const t=Math.trunc((this.w+this.h)/7);return new d(this.w-t*5,this.h-t*2)}};u.range={*diatonic(h=new u(0,0),t=new u(5,2)){const r=new u(5,2);let e=new u(h.w,h.h),i=e.add(r);const n=e.quality<0?-1:0;let s=e.h+n;const o=t;for(;o.subtract(i).stepspan>0;){for(;e.w<=i.w;){for(e.h=s;e.h<=i.h+1;)e.isDiatonic&&(yield new u(e.w,e.h)),e.h++;e.w++}i=i.add(r),s=e.h+n}for(;e.w<=i.w;){for(e.h=s;e.h<=i.h+1;){if(o.subtract(e).stepspan<0&&e.h++,e.w===o.w&&e.h>o.h)return;e.isDiatonic&&(yield new u(e.w,e.h)),e.h++}e.w++}},*melodic(){let h=new u(0,0);for(;h.w<=5;){for(;h.h<=2;)Math.abs(h.chroma)<6&&h.stepspan!==6&&(yield new u(h.w,h.h)),h.h++;h.h=0,h.w++}}};var M=u,v=class{constructor(h,t){this.x=h,this.y=t}toPitch(){return new D(this.x,this.y)}toInterval(){return new M(this.x,this.y)}},O=class T{constructor(t,r){this.m0=t,this.m1=r}map(t){return t instanceof v?this.m0*t.x+this.m1*t.y:this.m0*t.w+this.m1*t.h}compose(t){return new T(this.m0*t.m00+this.m1*t.m10,this.m0*t.m01+this.m1*t.m11)}},z=class q{constructor(t,r,e,i){this.m00=t,this.m01=r,this.m10=e,this.m11=i}map(t){return t instanceof v?new v(this.m00*t.x+this.m01*t.y,this.m10*t.x+this.m11*t.y):new v(this.m00*t.w+this.m01*t.h,this.m10*t.w+this.m11*t.h)}compose(t){return new q(this.m00*t.m00+this.m01*t.m10,this.m00*t.m01+this.m01*t.m11,this.m10*t.m00+this.m11*t.m10,this.m10*t.m01+this.m11*t.m11)}},y=class A{constructor(t,r="C4",e=261.6255653,i){this.referencePitch=P.toPitch(r),this.referenceFreq=e,this.centMap=new O(t,1200),i!==void 0&&(this.midiMap=i)}static fromEDO(t,r="C4",e=261.6255653){const i=Math.round(Math.log2(1.5)*t),n=i*1200/t,s=(i*2%t+t)%t,o=(i*-5%t+t)%t,m=new O(s,o);return new A(n,r,e,m)}toCents(t){return this.centMap.map(H.map(t))}toRatio(t){return 2**(this.toCents(t)/1200)}toHz(t){return this.referenceFreq*this.toRatio(this.referencePitch.intervalTo(t))}toMIDI(t){if(this.midiMap===void 0)throw new Error("Pitch.toMidi can only be called from an EDO TuningMap.");return this.midiMap.map(t)}},R=[{w:0,h:0},{w:1,h:0},{w:2,h:0},{w:2,h:1},{w:3,h:1},{w:4,h:1},{w:5,h:1}],H=new z(2,-5,-1,3);class a{static from(t,r){return M.fromName(t).add(new M(5*r,2*r))}}class B{static orchestrateCadence(t,r){const e=this.mapLetterToBasePitch(t,r);return this.getCadenceChordShapes().map(s=>this.buildChordFromShape(e,s)).map(s=>this.buildEventFromChord(s,r,1e3))}static mapLetterToBasePitch(t,r){let e=P.toPitch(`${t}3`);const i=P.toPitch("D3");return e==D.highest([e,i],y.fromEDO(r))&&(e=e.transposeReal(new M(-5,-2))),e}static getCadenceChordShapes(){return[[a.from("P1",0),a.from("M3",1),a.from("P5",1),a.from("P1",2)],[a.from("P4",0),a.from("P4",1),a.from("M6",1),a.from("P1",2)],[a.from("P5",0),a.from("M2",1),a.from("P5",1),a.from("M7",1)],[a.from("P1",0),a.from("M3",1),a.from("P5",1),a.from("P1",2)]]}static buildChordFromShape(t,r){return r.map(e=>t.transposeReal(e))}static buildEventFromChord(t,r,e){const i=y.fromEDO(r);return{frequencies:t.map(s=>i.toHz(s)),msLength:e}}}document.querySelector("#app").innerHTML=`
  <div>
    <h1>Cadence Test</h1>
    <div class="card">
      <button id="cadence" type="button">Test Cadence</button>
    </div>
  </div>
`;document.querySelector("#cadence")?.addEventListener("click",()=>{const h=B.orchestrateCadence("D",31);I.play(h)});
